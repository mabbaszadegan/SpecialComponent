<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sidebar Debug Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #f0f0f0;
        }
        .debug-info {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .debug-info h3 {
            margin-top: 0;
            color: #333;
        }
        .debug-info pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        .test-button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>Sidebar Component Debug Test</h1>
    
    <div class="debug-info">
        <h3>Component Status</h3>
        <div id="status">Loading...</div>
    </div>
    
    <div class="debug-info">
        <h3>Test Controls</h3>
        <button class="test-button" onclick="checkShadowRoot()">Check Shadow Root</button>
        <button class="test-button" onclick="checkCSS()">Check CSS</button>
        <button class="test-button" onclick="checkItems()">Check Items</button>
        <button class="test-button" onclick="forceRender()">Force Render</button>
    </div>
    
    <div class="debug-info">
        <h3>Console Output</h3>
        <div id="console-output" style="background: #000; color: #0f0; padding: 10px; border-radius: 4px; font-family: monospace; height: 200px; overflow-y: auto;"></div>
    </div>
    
    <!-- Simple Sidebar for Testing -->
    <sc-sidebar 
        id="debug-sidebar"
        theme="light"
        position="left"
        width="300px"
        collapsible
        show-header
        show-footer
        searchable>
        
        <sc-sidebar-item key="test1" text="Test Item 1" icon="fas fa-home"></sc-sidebar-item>
        <sc-sidebar-item key="test2" text="Test Item 2" icon="fas fa-user"></sc-sidebar-item>
        <sc-sidebar-item key="test3" text="Test Item 3" icon="fas fa-cog"></sc-sidebar-item>
    </sc-sidebar>
    
    <script src="sidebar.js"></script>
    <script>
        let sidebar;
        let consoleOutput;
        
        // Override console.log to capture output
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;
        
        function logToOutput(message, type = 'log') {
            if (consoleOutput) {
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = document.createElement('div');
                logEntry.style.color = type === 'error' ? '#ff6b6b' : type === 'warn' ? '#ffd93d' : '#0f0';
                logEntry.textContent = `[${timestamp}] ${message}`;
                consoleOutput.appendChild(logEntry);
                consoleOutput.scrollTop = consoleOutput.scrollHeight;
            }
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            logToOutput(args.join(' '), 'log');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            logToOutput(args.join(' '), 'warn');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            logToOutput(args.join(' '), 'error');
        };
        
        document.addEventListener('DOMContentLoaded', () => {
            consoleOutput = document.getElementById('console-output');
            sidebar = document.getElementById('debug-sidebar');
            
            logToOutput('DOM loaded, checking sidebar...');
            
            // Wait a bit for component to initialize
            setTimeout(() => {
                checkSidebarStatus();
            }, 100);
        });
        
        function checkSidebarStatus() {
            const statusDiv = document.getElementById('status');
            
            if (!sidebar) {
                statusDiv.innerHTML = '<span style="color: red;">‚ùå Sidebar element not found</span>';
                return;
            }
            
            if (!sidebar.shadowRoot) {
                statusDiv.innerHTML = '<span style="color: orange;">‚ö†Ô∏è Shadow root not created yet</span>';
                return;
            }
            
            const shadowContent = sidebar.shadowRoot.innerHTML;
            const hasCSS = shadowContent.includes('<style>');
            const hasContent = shadowContent.includes('sc-sidebar');
            
            let statusHTML = '<span style="color: green;">‚úÖ Sidebar found</span><br>';
            statusHTML += `<span style="color: ${hasCSS ? 'green' : 'red'};">${hasCSS ? '‚úÖ' : '‚ùå'} CSS: ${hasCSS ? 'Loaded' : 'Missing'}</span><br>`;
            statusHTML += `<span style="color: ${hasContent ? 'green' : 'red'};">${hasContent ? '‚úÖ' : '‚ùå'} Content: ${hasContent ? 'Rendered' : 'Not Rendered'}</span><br>`;
            statusHTML += `<span style="color: blue;">üìä Shadow Root Size: ${shadowContent.length} characters</span>`;
            
            statusDiv.innerHTML = statusHTML;
            
            logToOutput(`Sidebar status checked - CSS: ${hasCSS}, Content: ${hasContent}`);
        }
        
        function checkShadowRoot() {
            if (!sidebar) {
                logToOutput('‚ùå Sidebar not found');
                return;
            }
            
            if (!sidebar.shadowRoot) {
                logToOutput('‚ùå Shadow root not created');
                return;
            }
            
            logToOutput('‚úÖ Shadow root found');
            logToOutput(`Shadow root content length: ${sidebar.shadowRoot.innerHTML.length}`);
            
            // Check for specific elements
            const sidebarElement = sidebar.shadowRoot.querySelector('.sc-sidebar');
            if (sidebarElement) {
                logToOutput('‚úÖ .sc-sidebar element found');
                logToOutput(`Sidebar classes: ${sidebarElement.className}`);
                logToOutput(`Sidebar styles: ${sidebarElement.getAttribute('style')}`);
            } else {
                logToOutput('‚ùå .sc-sidebar element not found');
            }
        }
        
        function checkCSS() {
            if (!sidebar || !sidebar.shadowRoot) {
                logToOutput('‚ùå Cannot check CSS - sidebar or shadow root not ready');
                return;
            }
            
            const styleElement = sidebar.shadowRoot.querySelector('style');
            if (styleElement) {
                logToOutput('‚úÖ Style element found');
                logToOutput(`CSS content length: ${styleElement.textContent.length}`);
                logToOutput(`CSS preview: ${styleElement.textContent.substring(0, 200)}...`);
            } else {
                logToOutput('‚ùå Style element not found');
            }
            
            const linkElement = sidebar.shadowRoot.querySelector('link');
            if (linkElement) {
                logToOutput('‚úÖ FontAwesome link found');
                logToOutput(`FontAwesome URL: ${linkElement.href}`);
            } else {
                logToOutput('‚ùå FontAwesome link not found');
            }
        }
        
        function checkItems() {
            if (!sidebar) {
                logToOutput('‚ùå Sidebar not found');
                return;
            }
            
            logToOutput(`Items count: ${sidebar.items ? sidebar.items.length : 'undefined'}`);
            
            if (sidebar.items && sidebar.items.length > 0) {
                sidebar.items.forEach((item, index) => {
                    logToOutput(`Item ${index}: ${item.text} (${item.icon})`);
                });
            }
        }
        
        function forceRender() {
            if (!sidebar) {
                logToOutput('‚ùå Sidebar not found');
                return;
            }
            
            logToOutput('üîÑ Forcing render...');
            sidebar.render();
            logToOutput('‚úÖ Render completed');
            
            // Check status again
            setTimeout(checkSidebarStatus, 100);
        }
        
        // Check status every 2 seconds
        setInterval(checkSidebarStatus, 2000);
    </script>
</body>
</html>
